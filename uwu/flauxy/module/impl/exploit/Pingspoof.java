package uwu.flauxy.module.impl.exploit;

import com.darkmagician6.eventapi.EventTarget;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C00PacketKeepAlive;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import uwu.flauxy.event.impl.EventMotion;
import uwu.flauxy.event.impl.EventReceivePacket;
import uwu.flauxy.event.impl.EventSendPacket;
import uwu.flauxy.event.impl.EventUpdate;
import uwu.flauxy.module.Category;
import uwu.flauxy.module.Module;
import uwu.flauxy.module.ModuleInfo;
import uwu.flauxy.module.setting.impl.NumberSetting;
import uwu.flauxy.utils.PacketUtil;
import uwu.flauxy.utils.Wrapper;

import java.util.LinkedList;

@ModuleInfo(name = "PingSpoof", displayName = "Ping Spoof", key = -1, cat = Category.Exploit)
public class Pingspoof extends Module {

    LinkedList<Packet> packetQueue = new LinkedList<>();

    NumberSetting delay = new NumberSetting("Delay", 400, 100, 2500, 100);

    public Pingspoof(){
        addSettings(delay);
    }

    @EventTarget
    public void onSend(EventSendPacket event){
        if(event.getPacket() instanceof C0FPacketConfirmTransaction || event.getPacket() instanceof C00PacketKeepAlive){
            packetQueue.add(event.getPacket());
            event.setCancelled(true);
        }
        while (packetQueue.size() > delay.getValue()){
            Wrapper.instance.log("Sent packets");
            PacketUtil.packetNoEvent(packetQueue.poll());
            packetQueue.clear();
        }
    }

    @EventTarget
    public void onReceive(EventReceivePacket event){

    }

    @EventTarget
    public void onMotion(EventMotion event){

    }

    @EventTarget
    public void onUpdateEvent(EventUpdate event){

    }

}
