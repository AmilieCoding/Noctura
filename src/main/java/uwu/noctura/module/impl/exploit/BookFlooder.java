package uwu.noctura.module.impl.exploit;

import net.minecraft.network.play.client.C17PacketCustomPayload;
import net.minecraft.network.play.server.S40PacketDisconnect;
import uwu.noctura.event.Event;
import uwu.noctura.event.impl.EventReceivePacket;
import uwu.noctura.event.impl.EventUpdate;
import uwu.noctura.module.Category;
import uwu.noctura.module.Module;
import uwu.noctura.module.ModuleInfo;
import uwu.noctura.utils.PacketUtil;
import uwu.noctura.utils.Wrapper;

@ModuleInfo(name = "BookFlooder", cat = Category.Exploit, key = -1, displayName = "Book Flooder")
public class BookFlooder extends Module {

    boolean write;
    C17PacketCustomPayload fallbackPacket;

    @Override
    public void onEvent(Event e) {
        if(e instanceof EventUpdate) {
            write = false;
            if(mc.thePlayer.getHeldItem() == null) {
                return;
            }

            if(write && fallbackPacket != null) {
                C17PacketCustomPayload myPacket = new C17PacketCustomPayload();
                myPacket.channel = fallbackPacket.channel;
                myPacket.data = fallbackPacket.data;
                myPacket.data.writeString("MC|BSign");
                myPacket.data = null;
                Wrapper.instance.log(myPacket.getBufferData().readByte() + "");
                myPacket.getBufferData().writeByte(1222);
                Wrapper.instance.log(myPacket.getBufferData().readByte() + "");
                PacketUtil.sendSilentPacket(myPacket);
                fallbackPacket = null;
                write = false;
            }

        }
        if(e instanceof EventReceivePacket){
            // just to catch the nbt data lol
            if(((EventReceivePacket)e).getPacket() instanceof S40PacketDisconnect){
                // kick packet
                e.setCancelled(true);
            }
            if(((EventReceivePacket) e).getPacket() instanceof C17PacketCustomPayload){
                if(fallbackPacket.channel.equalsIgnoreCase("MC|BSign")){
                    fallbackPacket = ((EventReceivePacket) e).getPacket();
                    write = true;
                    e.setCancelled(true);
                }
            }
        }
    }
}