package uwu.flauxy.module.impl.exploit;

import net.minecraft.network.play.client.C14PacketTabComplete;
import net.minecraft.network.play.server.S3APacketTabComplete;
import uwu.flauxy.event.Event;
import uwu.flauxy.event.impl.EventReceivePacket;
import uwu.flauxy.module.Category;
import uwu.flauxy.module.Module;
import uwu.flauxy.module.ModuleInfo;
import uwu.flauxy.utils.PacketUtil;
import uwu.flauxy.utils.Wrapper;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashSet;
import java.util.Set;

@ModuleInfo(name = "PluginFinder", displayName = "Plugin Finder", key = -1, cat = Category.Exploit)
public class PluginFinder extends Module {

    Set<String> plugins = new HashSet<>(); // Using a Set to prevent duplicates

    @Override
    public void onEnable() {
        PacketUtil.packetNoEvent(new C14PacketTabComplete("/"));
    }

    @Override
    public void onEvent(Event e) {
        if (e instanceof EventReceivePacket) {
            EventReceivePacket ev = (EventReceivePacket) e;
            if (ev.getPacket() instanceof S3APacketTabComplete) {
                plugins.clear();
                S3APacketTabComplete packet = (S3APacketTabComplete) ev.getPacket();
                String[] commands = packet.func_149630_c();
                for (String command : commands) {
                    if (command.contains(":")) {
                        String plugin = command.split(":")[0].substring(1);
                        plugins.add(plugin);
                    }
                }
                ArrayList<String> pluginList = new ArrayList<>(plugins);
                Wrapper.instance.log("Plugins found: " + pluginList);
                this.toggle();
            }
        }
    }
}